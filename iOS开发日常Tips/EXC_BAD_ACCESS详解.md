#前言

本篇文章是我的大学同学所提供的内容，大家可以关注他的博客：[19九零](http://www.jianshu.com/users/28e9ad5126f4/latest_articles)。经同意，笔者将原文内容修改并增加新的内容。

本篇文章针对在开发中人人都遇到过而且经常遇到的异常EXC\_BAD\_ACCESS，这是很熟悉的味道吧！看见它的存在是否是有种想要刨根问底的冲动？脑子里瞬间出现为什么会这样出现这样的错误呢？

当遇到EXC\_BAD\_ACCESS，程序会造成崩溃。 这篇文件会告诉你什么是EXC\_BAD\_ACCESS以及它产生的原因，当然也会提供一些EXC\_BAD\_ACCESS异常的的解决方案。

#什么是EXC\_BAD\_ACCESS

一旦你理解EXC\_BAD\_ACCESS的本质，可更好地理解这个模糊的名词。这里有一个极为简单的解释，也有一个技术层面的解释。

**简单的解释：**

从语义上看，就是：异常_坏_访问，调整过来就是抛出不可访问该内存区的异常。

当你遇到EXC\_BAD\_ACCESS这个错误，那就意味着你向一个已经释放的对象发送消息。这是最常见的情况，但也有例外，我们将在稍后讨论。

**技术层面的解释：EXC\_BAD\_ACCESS的本质**

技术层面的解释有些复杂。在C和Objective-C中会一直在处理指针。指针无非是存储另一个变量的内存地址的变量。当您向一个对象发送消息时，指向该对象的指针将会被引用。这意味着，你获取了指针所指的内存地址，并将访问该存储区域的值。

当该存储器区域不再映射到您的应用时，或者换句话说，该内存区域在你认为使用的时候却没有使用，该内存区域是无法访问的。 这时内核会抛出一个异常（ EXC ），表明你的应用程序不能访问该存储器区域（BAD ACCESS） 。

总之，当你碰到EXC\_BAD\_ACCESS时，这意味着你试图发送消息到的内存块，但内存块无法执行该消息。但是，在某些情况下， EXC\_BAD\_ACCESS是由被损坏的指针引起的。每当你的应用程序尝试引用损坏的指针（野指针），一个异常就会被内核抛出。

#调试EXC\_BAD\_ACCESS

调试调试EXC\_BAD\_ACCESS可能会非常棘手和令人沮丧。然而，现在调试EXC\_BAD\_ACCESS可能会非常棘手和令人沮丧。然而，现在EXC\_BAD\_ACCESS不再是一个谜，它没有想象中的那么可怕。

你需要知道的第一件事是您的应用程序并不一定是在崩溃的那一刻，无法访问内存区域。这就是常使调试EXC\_BAD\_ACCESS变得困难的原因。

同样受损指针也是如此。当你的指针被损坏时，您的应用程序不会崩溃。同时，如果您在应用程序中来回传递一个受损的指针也不会崩溃。当应用程序试图引用受损指针的时候，就会发生奔溃。

那么，我们如何去调试EXC\_BAD\_ACCESS呢？

###僵尸调试模式

僵尸调试模式在过去几年中得到了普及，事实上它们已经出现在Xcode上超过十年。僵尸听起来有点戏剧性，但它实际上是为帮助我们调试EXC\_BAD\_ACCESS功能而取得一个伟大的名字。让我来解释它是如何工作的。

在Xcode中，您可以启用僵尸对象，这意味着被释放的对象将会以僵尸的形式被保留。换言之，保留释放的对象就是为了调试。这里没有涉及任何魔法。如果您向僵尸对象发送消息，你的应用程序将会由于EXC\_BAD\_ACCESS而崩溃。

这有什么好处吗？让EXC\_BAD\_ACCESS难以调试的原因是，你不知道你的应用程序试图访问哪个对象。僵尸对象在许多情况下解决这个问题。通过保留已释放的对象，Xcode可以告诉你你试图访问哪个对象，这使的查找问题原因容易得多。

在Xcode中启用僵尸对象是很容易的。注意，这可能会因的Xcode的版本而不同的。以下方法适用于Xcode的6和7：

1. 单击左上角的Edit Scheme，并选中Edit Scheme。
2. 在左侧选中Run ，在上方打开 Diagnostics选项。
3. 要启用僵尸对象，勾选 Enable Zombie Objects选框。

如下图所示：

![image](http://www.henishuo.com/wp-content/uploads/2016/02/QQ20160222-0@2x.png)

如果你现在遇到EXC\_BAD\_ACCESS ，在Xcode的控制台输出，告诉你该从哪里查找问题。看看下面的例子输出：

```
-[ChildViewController respondsToSelector:] message sent  to deallocated instance 0x17579780
```

在上面的例子中， Xcode告诉我们， respondsToSelector的消息：被发送到一个僵尸对象。然而，僵尸对象不再是ChildViewController类的一个实例。以前分配给ChildViewController实例的内存区域不再映射到您的应用程序。这为你了解问题产生的根本原因提供一个不错的建议。

不幸的是，僵尸对象将无法保存您的一天每次崩溃的EXC\_BAD\_ACCESS的记录。既然僵尸对象没有这些方法，那么你可以采取其他的方法进行一些适当的分析。

#通过分析Dead对象打预防针

如果僵尸对象不能解决你的问题，那么问题的根源可能就不那么简单了。在这种情况下，您需要仔细看看在应用程序崩溃时执行的代码。这可能是繁琐和耗时的。

为了帮助你发现你的代码的问题，你可以使用Xcode来分析你的代码，帮助你找到出现问题的地方。注意，Xcode分析项目，它会指出每一个潜在的可能出现的问题的地方。

使用Xcode来分析你的项目，从Xcode的 Product菜单选择**Analyze**或按**Shift-Command-B**。Xcode的将需要片刻的时间，但是当它完成的时候你会在左边的 Issue Navigator看到问题列表，由Analyze发现的问题用蓝色高亮显示。如下图所示：

![image](http://www.henishuo.com/wp-content/uploads/2016/02/屏幕快照-2016-02-22-下午12.07.37.png)

当你点击一个问题，Xcode的会指向问题代码块，这些正是你要的注意的地方。注意，Xcode仅仅是建议。在某些情况下，这是可能的，问题是不相关的的，不固定的。如下图：

![image](http://www.henishuo.com/wp-content/uploads/2016/02/1014109-60f3f0caab071356.jpg)

#提示

如果经过上面的方式，还是找不到造成EXC\_BAD\_ACCESS的错误，那就需要你仔细审视Xcode项目，分析其中发现的每一个问题。

#结论

EXC\_BAD\_ACCESS是开发者面临的一个共同的问题，它是手动内存管理固有的问题。虽然推行ARC内存管理方式 （自动引用计数）使得EXC\_BAD\_ACCESS没那么频繁，但他们并没有真正的消失。

#参考

* [What Is EXC_BAD_ACCESS and How to Debug It](http://code.tutsplus.com/tutorials/what-is-exc_bad_access-and-how-to-debug-it%E2%80%93cms-24544%20)

#关注我


关注                | 账号              | 备注
-------------      | -------------     | ----------------
Swift/ObjC技术群一  | 324400294         |  群一若已满，请申请群二
Swift/ObjC技术群二  | 494669518         | 群二若已满，请申请群三
Swift/ObjC技术群三  | 461252383         | 群三若已满，会有提示信息
关注微信公众号       | iOSDevShares      | 关注微信公众号，会定期地推送好文章
关注新浪微博账号      |  [标哥Jacky](http://weibo.com/u/5384637337) | 关注微博，每次发布文章都会分享到新浪微博
关注标哥的GitHub     | [CoderJackyHuang](https://github.com/CoderJackyHuang) | 这里有很多的Demo和开源组件
关于我               | [进一步了解标哥](http://www.henishuo.com/about-biaoge/) | 如果觉得文章对您很有帮助，可捐助我！


